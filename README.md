# Документация (jenkins)

[Документация по API, собирается автоматически](http://shadowblade.module.ru/job/Basis-B1/job/rumboot/CMAKE_BUILD_TYPE=Debug,RUMBOOT_PLATFORM=native,label=taruca/Doxygen_HTML_Docs/)

# Сборка документации

```
cd rumboot
mkdir build-doc
cd build-doc
cmake ..
make docs
```

HTML Документация будет сгенерирована в каталоге doc/

# Добавление нового теста (при сборке вместе с проектом СБИС basis)

## Простые тесты

Простые тесты представляю собой тесты состоящие из одного файла. Они собираются вместо BootROM и исполняются оттуда. Для их создания не требуется редактировать CMakeLists.txt Достаточно выполнить следующие шаги:

- Создать файл rumboot/src/platform/basis/targets/simple-rom/testname.c, за основу взять hello.c из этого же каталога
- Функция main() должна возвращать 0 для успешного завершения теста. Любое другое значение, возвращаемое из main() будет интерпретировано как ошибка.
- Переконфигурировать проект СБИС и пересобрать все подпроекты (т.е. запустить в командной строке)

```
cmake path/to/src/
make
```
- Запустить соответствующий сценарий в директории runners/

_ОЧЕНЬ ВАЖНО:_
-   Автоматически добавляемые тесты не попадают в список "короткой" регрессии, которая запускается системой непрерывной интеграции на каждый коммит. Добавление тестов в этот список производится вручную в файле cmake/platforms/basis.cmake (см. макрофункцию RUMBOOT_SHORT_REGESSION_LIST)

- Не надо два раза добавлять тесты в полную регрессию, полная включает в себя в т.ч. и короткую

## Добавление сложных тестов

Сложные тесты состоят из нескольких файлов и/или используют пользовательский ld сценарий. Для их добавления необходимо отредактировать файл cmake/platforms/basis.cmake (см. макрофункции       RUMBOOT_FULL_REGESSION_LIST/RUMBOOT_SHORT_REGESSION_LIST)

ld сценарии необходимо помещать в директорию ld/basis/*.lds

## Список тестов (библиотека testsuite)
Для экономии времени и простоты можно комбинировать простые однотипные тесты периферии в наборы.

Пример использования библиотеки testsuite - см. rumboot/src/platform/basis/targets/simple-rom/testname.c


- Соответствующий скрипт запуска будет добавлен в каталог runners/

## Многопоточный запуск тестов

```
    cmake path/to/basis/source
    make
    ctest -j4
```

Будет запускать до четырех процессов ncsim. Логи сохраняются в директории Testing. Перед установкой большого числа потоков убедитесь в наличии большого количества оперативной памяти на выбранном сервере
