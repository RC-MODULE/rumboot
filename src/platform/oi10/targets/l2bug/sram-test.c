#include <stdint.h>
#include <stdlib.h>
#include <rumboot/printf.h>


extern void memcpy_copyed ( void *d, void *s, size_t n );


volatile char __attribute__( ( section( ".testdata.monitor_version" ) ) ) monitor_version[153] =
{
    0x33, 0x30, 0x32, 0x65, 0x33, 0x33, 0x32, 0x65, 0x33, 0x30, 0x32, 0x30, 0x34, 0x64, 0x35, 0x34,
    0x33, 0x31, 0x33, 0x35, 0x33, 0x30, 0x33, 0x30, 0x33, 0x32, 0x32, 0x30, 0x36, 0x33, 0x36, 0x36,
    0x33, 0x35, 0x36, 0x32, 0x36, 0x35, 0x33, 0x32, 0x33, 0x30, 0x32, 0x30, 0x33, 0x32, 0x33, 0x30,
    0x33, 0x32, 0x33, 0x31, 0x32, 0x64, 0x33, 0x30, 0x33, 0x35, 0x32, 0x64, 0x33, 0x33, 0x33, 0x31,
    0x30, 0x61, 0x30, 0x39, 0x36, 0x37, 0x36, 0x34, 0x36, 0x32, 0x36, 0x64, 0x36, 0x66, 0x36, 0x65,
    0x30, 0x39, 0x30, 0x39, 0x33, 0x30, 0x32, 0x65, 0x33, 0x34, 0x33, 0x30, 0x32, 0x65, 0x33, 0x30,
    0x30, 0x39, 0x33, 0x37, 0x33, 0x36, 0x33, 0x38, 0x36, 0x35, 0x33, 0x33, 0x33, 0x37, 0x33, 0x30,
    0x30, 0x61, 0x30, 0x39, 0x37, 0x33, 0x37, 0x34, 0x36, 0x34, 0x36, 0x63, 0x36, 0x39, 0x36, 0x32,
    0x30, 0x39, 0x30, 0x39, 0x33, 0x30, 0x32, 0x65, 0x33, 0x33, 0x32, 0x65, 0x33, 0x32, 0x32, 0x64,
    0x36, 0x34, 0x36, 0x35, 0x37, 0x36, 0x30, 0x61, 0x00
};
volatile char __attribute__( ( section( ".testdata.tx_buf" ) ) ) tx_buf[1024] = "hi";


int main ( void )
{
    uint32_t *p_dest, *p_src;
    uint32_t *ptr;
    int i, j, k;

    for ( i = 0; i < 10; i++ )
    {
        memcpy_copyed( ( void * )tx_buf, ( void * )monitor_version, 153 );

        p_dest = ( uint32_t * )tx_buf;
        p_src = ( uint32_t * )monitor_version;

        for ( j = 0; j < 38; j++ )
        {
            if ( *p_dest != *p_src )
            {
                rumboot_printf( "i = %d\n", i );

                ptr = ( uint32_t * )tx_buf;

                for ( i = 0; i < 38; i++ )
                {
                    rumboot_printf( "%d: 0x%x\t0x%x\n", i, ( uint32_t )ptr, *ptr );
                    ptr++;
                }

                ptr = ( uint32_t * )monitor_version;

                for ( i = 0; i < 38; i++ )
                {
                    rumboot_printf( "%d: 0x%x\t0x%x\n", i, ( uint32_t )ptr, *ptr );
                    ptr++;
                }

                while ( 1 )
                {

                }
            }

            p_dest++;
            p_src++;
        }
    }

    return 0;
}
